# ===========================================
# Traefik Dynamic Configuration - Development Services
# ===========================================
# Use this when running services on host machine (not in Docker)
# Overrides service URLs to use host.docker.internal

http:
  services:
    user-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8001"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    pod-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8002"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    material-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8003"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    search-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8004"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    ai-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8005"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    notification-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8006"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    file-processor:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8007"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

    material-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8003"
        healthCheck:
          path: /health
          interval: 10s
          timeout: 3s
        passHostHeader: true

  routers:
    # ===========================================
    # AI Service Routes
    # ===========================================
    # AI behavior data endpoint
    ai-service-behavior:
      rule: "Path(`/api/v1/ai/behavior`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: ai-service
      priority: 100

    # Material-specific chat endpoints
    ai-service-material-chat:
      rule: "PathPrefix(`/api/v1/materials`) && PathRegexp(`/api/v1/materials/[^/]+/chat`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-ai
      service: ai-service
      priority: 120

    # Pod-wide chat endpoints
    ai-service-pod-chat:
      rule: "PathPrefix(`/api/v1/pods`) && PathRegexp(`/api/v1/pods/[^/]+/chat`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-ai
      service: ai-service
      priority: 120

    # Chat feedback endpoint
    ai-service-feedback:
      rule: "PathPrefix(`/api/v1/chat`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: ai-service
      priority: 95

    # ===========================================
    # File Processor Routes (Learning Pulse)
    # ===========================================
    learning-pulse:
      rule: "PathPrefix(`/api/v1/learning-pulse`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: file-processor
      priority: 90

    # ===========================================
    # Offline Material Service Routes
    # ===========================================
    # Offline device management
    offline-service-devices:
      rule: "PathPrefix(`/api/v1/offline/devices`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: material-service
      priority: 100

    # Offline license management
    offline-service-licenses:
      rule: "PathPrefix(`/api/v1/offline/licenses`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: material-service
      priority: 100

    # Offline material operations (license issuance, download)
    offline-service-materials:
      rule: "PathRegexp(`/api/v1/offline/materials/[^/]+/(license|download|job)`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: material-service
      priority: 110

    # Offline job status
    offline-service-jobs:
      rule: "PathPrefix(`/api/v1/offline/jobs`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: material-service
      priority: 100

    # Offline sync endpoint
    offline-service-sync:
      rule: "Path(`/api/v1/offline/sync`)"
      entryPoints:
        - web
      middlewares:
        - cors-headers
        - security-headers
        - rate-limit-general
      service: material-service
      priority: 100
