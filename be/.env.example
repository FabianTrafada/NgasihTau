# ===========================================
# NgasihTau Backend Environment Configuration
# ===========================================
# Copy this file to .env and fill in the values

# Application
APP_ENV=development  # development, staging, production
APP_DEBUG=true
APP_LOG_LEVEL=debug  # debug, info, warn, error

# ===========================================
# User Service
# ===========================================
USER_SERVICE_HOST=0.0.0.0
USER_SERVICE_PORT=8001
USER_SERVICE_GRPC_PORT=9001

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_ACCESS_TOKEN_EXPIRY=15m
JWT_REFRESH_TOKEN_EXPIRY=168h  # 7 days

# Password Hashing
BCRYPT_COST=12

# 2FA Configuration
TOTP_ISSUER=NgasihTau
TOTP_SECRET_ENCRYPTION_KEY=32-byte-encryption-key-here!!

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URL=http://localhost:3000/auth/google/callback

# ===========================================
# Pod Service
# ===========================================
POD_SERVICE_HOST=0.0.0.0
POD_SERVICE_PORT=8002
POD_SERVICE_GRPC_PORT=9002

# ===========================================
# Material Service
# ===========================================
MATERIAL_SERVICE_HOST=0.0.0.0
MATERIAL_SERVICE_PORT=8003
MATERIAL_SERVICE_GRPC_PORT=9003

# File Upload Limits
MAX_FILE_SIZE_MB=100
ALLOWED_FILE_TYPES=pdf,docx,pptx
PRESIGNED_URL_EXPIRY=5m

# ===========================================
# Search Service
# ===========================================
SEARCH_SERVICE_HOST=0.0.0.0
SEARCH_SERVICE_PORT=8004

# ===========================================
# AI Service
# ===========================================
AI_SERVICE_HOST=0.0.0.0
AI_SERVICE_PORT=8005

# OpenAI Configuration
OPENAI_API_KEY=your-openai-api-key
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_CHAT_MODEL=gpt-4

# Text Chunking
CHUNK_SIZE_MIN=500
CHUNK_SIZE_MAX=1000
CHUNK_OVERLAP=100

# ===========================================
# Notification Service
# ===========================================
NOTIFICATION_SERVICE_HOST=0.0.0.0
NOTIFICATION_SERVICE_PORT=8006

# Email Configuration (SMTP)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your-smtp-user
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_EMAIL=noreply@ngasihtau.com
SMTP_FROM_NAME=NgasihTau

# ===========================================
# File Processor Service (Python)
# ===========================================
FILE_PROCESSOR_HOST=0.0.0.0
FILE_PROCESSOR_PORT=8007
FILE_PROCESSOR_URL=http://file-processor:8007

# ===========================================
# PostgreSQL Database
# ===========================================
# Each service has a dedicated database and user for security isolation
# See scripts/init-databases.sh for user creation and permissions
#
# Superuser credentials (for migrations and admin tasks only)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# User Service Database
USER_DB_HOST=localhost
USER_DB_PORT=5432
USER_DB_NAME=ngasihtau_users
USER_DB_USER=user_svc
USER_DB_PASSWORD=user_svc_password
USER_DB_SSL_MODE=disable
USER_DB_MAX_OPEN_CONNS=25
USER_DB_MAX_IDLE_CONNS=10
USER_DB_CONN_MAX_LIFETIME=5m
# Migration URL (used by golang-migrate CLI)
USER_DB_URL=postgres://user_svc:user_svc_password@localhost:5432/ngasihtau_users?sslmode=disable

# Pod Service Database
POD_DB_HOST=localhost
POD_DB_PORT=5432
POD_DB_NAME=ngasihtau_pods
POD_DB_USER=pod_svc
POD_DB_PASSWORD=pod_svc_password
POD_DB_SSL_MODE=disable
POD_DB_MAX_OPEN_CONNS=20
POD_DB_MAX_IDLE_CONNS=8
POD_DB_CONN_MAX_LIFETIME=5m

# Material Service Database
MATERIAL_DB_HOST=localhost
MATERIAL_DB_PORT=5432
MATERIAL_DB_NAME=ngasihtau_materials
MATERIAL_DB_USER=material_svc
MATERIAL_DB_PASSWORD=material_svc_password
MATERIAL_DB_SSL_MODE=disable
MATERIAL_DB_MAX_OPEN_CONNS=15
MATERIAL_DB_MAX_IDLE_CONNS=5
MATERIAL_DB_CONN_MAX_LIFETIME=5m

# AI Service Database
AI_DB_HOST=localhost
AI_DB_PORT=5432
AI_DB_NAME=ngasihtau_ai
AI_DB_USER=ai_svc
AI_DB_PASSWORD=ai_svc_password
AI_DB_SSL_MODE=disable
AI_DB_MAX_OPEN_CONNS=10
AI_DB_MAX_IDLE_CONNS=5
AI_DB_CONN_MAX_LIFETIME=5m

# Notification Service Database
NOTIFICATION_DB_HOST=localhost
NOTIFICATION_DB_PORT=5432
NOTIFICATION_DB_NAME=ngasihtau_notifications
NOTIFICATION_DB_USER=notification_svc
NOTIFICATION_DB_PASSWORD=notification_svc_password
NOTIFICATION_DB_SSL_MODE=disable
NOTIFICATION_DB_MAX_OPEN_CONNS=10
NOTIFICATION_DB_MAX_IDLE_CONNS=5
NOTIFICATION_DB_CONN_MAX_LIFETIME=5m

# Search Service Database
SEARCH_DB_HOST=localhost
SEARCH_DB_PORT=5432
SEARCH_DB_NAME=ngasihtau_search
SEARCH_DB_USER=search_svc
SEARCH_DB_PASSWORD=search_svc_password
SEARCH_DB_SSL_MODE=disable
SEARCH_DB_MAX_OPEN_CONNS=10
SEARCH_DB_MAX_IDLE_CONNS=5
SEARCH_DB_CONN_MAX_LIFETIME=5m

# ===========================================
# Redis
# ===========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_POOL_TIMEOUT=4s
REDIS_IDLE_TIMEOUT=5m

# ===========================================
# NATS JetStream
# ===========================================
NATS_URL=nats://localhost:4222
NATS_CLUSTER_ID=ngasihtau-cluster
NATS_CLIENT_ID=ngasihtau-backend

# ===========================================
# MinIO Object Storage
# ===========================================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_USE_SSL=false
MINIO_BUCKET_MATERIALS=materials

# ===========================================
# Meilisearch
# ===========================================
MEILISEARCH_HOST=http://localhost:7700
MEILISEARCH_API_KEY=your-meilisearch-master-key

# ===========================================
# Qdrant Vector Database
# ===========================================
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION=material_chunks

# ===========================================
# Traefik API Gateway
# ===========================================
TRAEFIK_DASHBOARD_PORT=8080
TRAEFIK_ENTRYPOINT_PORT=80

# ===========================================
# Rate Limiting
# ===========================================
RATE_LIMIT_AUTH=10        # requests per minute
RATE_LIMIT_SEARCH=60      # requests per minute
RATE_LIMIT_AI_CHAT=30     # requests per minute
RATE_LIMIT_UPLOAD=10      # requests per minute
RATE_LIMIT_GENERAL=100    # requests per minute

# ===========================================
# CORS Configuration
# ===========================================
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-ID
CORS_MAX_AGE=86400

# ===========================================
# Observability
# ===========================================
# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_SERVICE_NAME=ngasihtau

# Prometheus Metrics
METRICS_ENABLED=true
METRICS_PORT=9090
